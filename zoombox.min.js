var scr=document.getElementsByTagName("script"),zoombox_path=scr[scr.length-1].getAttribute("src").replace("zoombox.js","");!function(o){function e(){"closed"==H&&(j=!1),H="load",x(),F.test(g)?(img=new Image,img.src=g,o("body").append('<div id="zoombox_loader"></div>'),o("#zoombox_loader").css("marginTop",z()),_=window.setInterval(function(){l(img)},100)):(m(),a())}function t(){o("body").append(E),o(window).keydown(function(o){b(o.which)}),o(window).resize(function(){d()}),o(window).mousewheel(function(o){h(o.deltaY)}),o("#zoombox .zoombox_mask").hide(),o("#zoombox").addClass(T.theme),o("#zoombox .zoombox_mask,.zoombox_close").click(function(){return n(),!1}),0==I?o("#zoombox .zoombox_next,#zoombox .zoombox_prev").remove():(o("#zoombox .zoombox_next").click(function(){s()}),o("#zoombox .zoombox_prev").click(function(){c()}))}function i(){var e=0,t=0;if(T.gallery){if(I===!1)return o("#zoombox .zoombox_gallery").remove(),!1;for(var i in I){var a="http://host.github.com/img/play.png",n=o('<img src="'+a+'" class="video gallery'+1*i+'"/>');F.test(I[i].attr("href"))&&(a=I[i].attr("href"),n=o('<img src="'+a+'" class="gallery'+1*i+'"/>')),n.data("id",i).appendTo("#zoombox .zoombox_gallery"),n.click(function(){r(Number(o(this).data("id"))),o("#zoombox .zoombox_gallery img").removeClass("current"),o(this).addClass("current")}),i==Y&&n.addClass("current"),o("<img/>").data("img",n).attr("src",a).load(function(){e++;var i=o(this).data("img");if(i.width(Math.round(i.height()*this.width/this.height)),e==o("#zoombox .zoombox_gallery img").length){var a=0;o("#zoombox .zoombox_gallery img").each(function(){a+=o(this).outerWidth(),o(this).data("left",a)});var n=o("<div>").css({position:"absolute",top:0,left:0,width:a});o("#zoombox .zoombox_gallery").wrapInner(n),t=o("#zoombox .zoombox_gallery").width(),o("#zoombox").trigger("change")}})}o("#zoombox .zoombox_gallery").show().animate({bottom:0},T.duration)}o("#zoombox").bind("change",function(e,t){if(o("#zoombox .zoombox_gallery div").width()<o("#zoombox .zoombox_gallery").width)return!0;var i=0,a=0;null!=t?(i=T.duration,a=t.width/2):a=o("#zoombox .zoombox_gallery").width()/2;var n=-o("#zoombox .zoombox_gallery img.current").data("left")+o("#zoombox .zoombox_gallery img.current").width()/2,m=n+a;m<2*a-o("#zoombox .zoombox_gallery div").width()&&(m=2*a-o("#zoombox .zoombox_gallery div").width()),m>0&&(m=0),o("#zoombox .zoombox_gallery div").animate({left:m},i)})}function a(){if(0==j?t():o("#zoombox .zoombox_title").empty(),o("#zoombox .close").hide(),o("#zoombox .zoombox_container").removeClass("multimedia").removeClass("img").addClass(O),o("body").addClass("zoombox-open"),null!=w&&w.attr("title")&&o("#zoombox .zoombox_title").append(w.attr("title")),o("#zoombox .zoombox_content").empty(),"img"==O&&0==j&&1==T.animation&&o("#zoombox .zoombox_content").append(k),null!=w&&0!=w.find("img").length&&0==j){var e=w.find("img");o("#zoombox .zoombox_container").css({width:e.width(),height:e.height(),top:e.offset().top,left:e.offset().left,opacity:0,marginTop:e.css("marginTop")})}else null!=w&&0==j?o("#zoombox .zoombox_container").css({width:w.width(),height:w.height(),top:w.offset().top,left:w.offset().left}):0==j&&o("#zoombox .zoombox_container").css({width:100,height:100,top:u()/2-50,left:p()/2-50});var a={width:v,height:y,left:(p()-v)/2,top:(u()-y)/2,marginTop:z(),opacity:1};o("#zoombox").trigger("change",a),1==T.animation?(o("#zoombox .zoombox_title").hide(),o("#zoombox .zoombox_close").hide(),o("#zoombox .zoombox_container").animate(a,T.duration,function(){("multimedia"==O||1==j)&&o("#zoombox .zoombox_content").append(k),("image"==O||1==j)&&o("#zoombox .zoombox_content img").css("opacity",0).fadeTo(300,1),o("#zoombox .zoombox_title").fadeIn(300),o("#zoombox .zoombox_close").fadeIn(300),H="opened",j||i(),j=!0}),o("#zoombox .zoombox_mask").fadeTo(200,T.opacity)):(o("#zoombox .zoombox_content").append(k),o("#zoombox .zoombox_close").show(),o("#zoombox .zoombox_gallery").show(),o("#zoombox .zoombox_container").css(a),o("#zoombox .zoombox_mask").show(),o("#zoombox .zoombox_mask").css("opacity",T.opacity),j||i(),j=!0,H="opened")}function n(){H="closing",window.clearInterval(_),o(window).unbind("keydown"),o(window).unbind("resize"),o(window).unmousewheel(),"multimedia"==O&&o("#zoombox .zoombox_container").empty();var e={};if(null!=w&&w.find("img").length>0){var t=w.find("img");e={width:t.width(),height:t.height(),top:t.offset().top,left:t.offset().left,opacity:0,marginTop:t.css("marginTop")}}else e=null!=w?{width:w.width(),height:w.height(),top:w.offset().top,left:w.offset().left,marginTop:0,opacity:0}:{width:100,height:100,top:u()/2-50,left:p()/2-50,opacity:0};1==T.animation?(o("#zoombox .zoombox_mask").fadeOut(200),o("#zoombox .zoombox_gallery").animate({bottom:-o("#zoombox .zoombox_gallery").innerHeight()},T.duration),o("#zoombox .zoombox_container").animate(e,T.duration,function(){o("#zoombox").remove(),H="closed",j=!1})):(o("#zoombox").remove(),H="closed",j=!1),o("body").removeClass("zoombox-open")}function m(){0==T.overflow&&(1*v+50>p()&&(y=(p()-50)*y/v,v=p()-50),1*y+50>u()&&(v=(u()-50)*v/y,y=u()-50));var o=g;if(O="multimedia",F.test(o))O="img",k='<img src="'+g+'" width="100%" height="100%"/>';else if(M.test(o))v=300,y=40,k='<object type="application/x-shockwave-flash" data="'+MP3Player+"?son="+o+'" width="'+v+'" height="'+y+'">',k+='<param name="movie" value="'+MP3Player+"?son="+o+'" /></object>';else if(P.test(o)){var e=0;1==T.autoplay&&(e=1),k='<object type="application/x-shockwave-flash" data="'+zoombox_path+'FLVplayer.swf" width="'+v+'" height="'+y+'"><param name="allowFullScreen" value="true"><param name="scale" value="noscale"><param name="wmode" value="transparent"><param name="flashvars" value="flv='+o+"&autoplay="+e+'"><embed src="'+zoombox_path+'FLVplayer.swf" width="'+v+'" height="'+y+'" allowscriptaccess="always" allowfullscreen="true" flashvars="flv='+o+'" wmode="transparent" /></object>'}else if(W.test(o))k='<object width="'+v+'" height="'+y+'"><param name="allowfullscreen" value="true" /><param name="allowscriptaccess" value="always" /><param name="movie" value="'+o+'" /><embed src="'+o+'" type="application/x-shockwave-flash" allowfullscreen="true" allowscriptaccess="always" width="'+v+'" height="'+y+'" wmode="transparent"></embed></object>';else if(A.test(o))k='<embed src="'+o+'" width="'+v+'" height="'+y+'" controller="true" cache="true" autoplay="true"/>';else if(q.test(o))k='<embed src="'+o+'" width="'+v+'" height="'+y+'" controller="true" cache="true" autoplay="true" wmode="transparent" />';else if(L.test(o)){var t=o.split("_");t=t[0].split("/"),t=t[t.length-1]+"?",1==T.autoplay&&(t+="autoPlay=1&"),k='<iframe frameborder="0" width="'+v+'" height="'+y+'" src="http://www.dailymotion.com/embed/video/'+t+'?wmode=transparent"></iframe>'}else if(S.test(o)){var t=o.split("/");t=t[3]+"?",1==T.autoplay&&(t+="autoplay=1&"),k='<iframe src="http://player.vimeo.com/video/'+t+'title=0&byline=0&portrait=0&wmode=transparent" width="'+v+'" height="'+y+'" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>'}else if(B.test(o)){var t=o.split("watch?v=");t=t[1].split("&"),t=t[0]+"?",1==T.autoplay&&(t+="autoplay=1&"),k='<iframe width="'+v+'" height="'+y+'" src="http://www.youtube.com/embed/'+t+'wmode=Opaque" frameborder="0" allowfullscreen></iframe>'}else N.test(o)?(o=o.split(".html"),o=o[0],k='<object type="application/x-shockwave-flash" data="'+o+'" width="'+v+'" height="'+y+'"><param name="movie" value="'+o+'"><embed src="'+o+'" type="application/x-shockwave-flash" width="'+v+'" height="'+y+'"  wmode="transparent"></embed></object>'):k='<iframe src="'+o+'" width="'+v+'" height="'+y+'" border="0"></iframe>';return k}function l(e){e.complete&&(C=0,window.clearInterval(_),v=e.width,y=e.height,o("#zoombox_loader").remove(),m(),a()),o("#zoombox_loader").css({"background-position":"0px "+C+"px"}),C-=40,-440>C&&(C=0)}function r(t){return"opened"!=H?!1:(I&&(Y=t,w=I[Y],g=w.attr("href"),o("#zoombox .zoombox_gallery img").length>0&&(o("#zoombox .zoombox_gallery img").removeClass("current"),o("#zoombox .zoombox_gallery img:eq("+t+")").addClass("current")),e()),!1)}function s(){C=Y+1,C>I.length-1&&(C=0),r(C)}function c(){C=Y-1,0>C&&(C=I.length-1),r(C)}function d(){o("#zoombox .zoombox_container").css({top:(u()-o("#zoombox .zoombox_container").outerHeight(!0))/2,left:(p()-o("#zoombox .zoombox_container").outerWidth(!0))/2})}function b(o){37==o&&c(),39==o&&s(),27==o&&n()}function h(o){o>0?c():s()}function x(){if(v=T.width,y=T.height,null!=w){var o=/w([0-9]+)/,e=o.exec(w.attr("class"));null!=e&&e[1]&&(v=e[1]);var t=/h([0-9]+)/,i=t.exec(w.attr("class"));null!=i&&i[1]&&(y=i[1])}return!1}function u(){return window.innerHeight?window.innerHeight:o(window).height()}function p(){return window.innerWidth?window.innerWidth:o(window).width()}function z(){return scrOfY=0,"number"==typeof window.pageYOffset?scrOfY=window.pageYOffset:document.body&&document.body.scrollTop?scrOfY=document.body.scrollTop:document.documentElement&&document.documentElement.scrollTop&&(scrOfY=document.documentElement.scrollTop),scrOfY}var f,w,g,v,y,_,k,T={theme:"zoombox",opacity:.8,duration:800,animation:!0,width:600,height:400,gallery:!0,autoplay:!1,overflow:!1},j=!1,C=0,O="multimedia",Y=!1,I=!1,H="closed",E='<div id="zoombox">             <div class="zoombox_mask"></div>            <div class="zoombox_container">                <div class="zoombox_content"></div>                <div class="zoombox_title"></div>                <div class="zoombox_next"></div>                <div class="zoombox_prev"></div>                <div class="zoombox_close"></div>            </div>            <div class="zoombox_gallery"></div>        </div>',F=/(\.jpg)|(\.jpeg)|(\.bmp)|(\.gif)|(\.png)/i,M=/(\.mp3)/i,P=/(\.flv)/i,W=/(\.swf)/i,A=/(\.mov)|(\.mp4)/i,q=/(\.wmv)|(\.avi)/i,L=/(http:\/\/www.dailymotion)|(http:\/\/dailymotion)/i,S=/(http:\/\/www.vimeo)|(http:\/\/vimeo)/i,B=/(youtube\.)/i,N=/(http:\/\/www\.koreus)|(http:\/\/koreus)/i;o.zoombox=function(){},o.zoombox.options=T,o.zoombox.close=function(){n()},o.zoombox.open=function(t,i){w=null,g=t,T=o.extend({},o.zoombox.options,i),e()},o.zoombox.html=function(e,t){k=e,T=o.extend({},o.zoombox.options,t),v=T.width,y=T.height,w=null,a()},o.fn.zoombox=function(t){return f=new Array,this.each(function(){if(o.browser&&o.browser.msie&&o.browser.version<7&&!window.XMLHttpRequest)return!1;var i=this,a=/zgallery([0-9]+)/,n=/zskip/,m=a.exec(o(this).attr("class")),l=n.exec(o(this).attr("class")),r=!1;if(null!=m){f[m[1]]||(f[m[1]]=new Array),null==l&&f[m[1]].push(o(this));var s=f[m[1]].length-1;r=f[m[1]]}o(this).unbind("click").click(function(){return T=o.extend({},o.zoombox.options,t),"closed"!=H?!1:(null!=l?s<f[m[1]].length-1&&(w=f[m[1]][s+1]):w=o(i),I=r,g=w.attr("href"),Y=s,e(),!1)})})}}(jQuery);